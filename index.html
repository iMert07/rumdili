<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RUM TILI</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      font-size: 16px;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      margin-bottom: 10px;
    }
    .top-bar h1 {
      margin: 0;
      margin-top: -10px;
    }
    #searchInput {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      box-sizing: border-box;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 15px;
    }
    .suggestion {
      padding: 10px;
      background-color: #f8f9fa;
      margin: 4px 0;
      cursor: pointer;
      border-radius: 4px;
      display: flex;
      align-items: center;
      font-size: 14px;
    }
    .suggestion:hover {
      background-color: #e9ecef;
    }
    .main-word {
      font-weight: bold;
    }
    .synonym-hint {
      color: #888;
      margin-left: 8px;
      font-size: 0.95em;
    }
    #suggestions {
      border: 1px solid #eee;
      border-radius: 4px;
      max-height: 300px;
      overflow-y: auto;
    }
    #result {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <h1>RUM TILI</h1>
  </div>

  <input type="text" id="searchInput" placeholder="SÖZCÜK ARA..." autocomplete="off" />
  <div id="suggestions"></div>
  <div id="result"></div>

  <script>
    const alphabet = 'abcçdefgğhıijklmnoöprsştuüvxyzwq';
    function normalizeForSearch(str) {
      return str.toLowerCase().normalize("NFC");
    }

    function customCompare(a, b) {
      const alen = a.length, blen = b.length;
      const minLen = Math.min(alen, blen);
      for (let i = 0; i < minLen; i++) {
        const ca = a[i], cb = b[i];
        if (ca === cb) continue;
        const ia = alphabet.indexOf(ca);
        const ib = alphabet.indexOf(cb);
        if (ia === -1 || ib === -1) return ca.localeCompare(cb);
        return ia - ib;
      }
      return alen - blen;
    }

    let allWords = [];

    async function fetchWords() {
      const url = 'https://opensheet.elk.sh/1R01aIajx6dzHlO-KBiUXUmld2AEvxjCQkUTFGYB3EDM/Sözlük';
      const res = await fetch(url);
      allWords = await res.json();
    }

    function displaySuggestions(query) {
      const q = normalizeForSearch(query);
      const matches = [];

      allWords.forEach(row => {
        const main = row.Sözcük || '';
        const normMain = normalizeForSearch(main);
        const synonyms = (row['Eş Anlamlılar'] || '').split(',').map(s => s.trim());
        const normSynonyms = synonyms.map(s => normalizeForSearch(s));

        if (normMain.startsWith(q)) {
          matches.push({ shown: main, word: main, synonym: null, row });
        } else {
          const matchedSyn = synonyms.find(s => normalizeForSearch(s).startsWith(q));
          if (matchedSyn) {
            matches.push({ shown: matchedSyn, word: main, synonym: matchedSyn, row });
          }
        }
      });

      matches.sort((a, b) => {
        const cmp = customCompare(normalizeForSearch(a.shown), normalizeForSearch(b.shown));
        if (cmp !== 0) return cmp;
        return customCompare(normalizeForSearch(a.word), normalizeForSearch(b.word));
      });

      const container = document.getElementById('suggestions');
      container.innerHTML = '';

      if (matches.length === 0) {
        container.innerHTML = '<div class="suggestion">Sonuç bulunamadı</div>';
        return;
      }

      matches.slice(0, 12).forEach(match => {
        const div = document.createElement('div');
        div.className = 'suggestion';
        div.innerHTML = `
          <span class="main-word">${match.word}</span>
          ${match.synonym ? `<span class="synonym-hint">${match.shown}</span>` : ''}
        `;
        div.onclick = () => showResult(match.row);
        container.appendChild(div);
      });
    }

    function showResult(row) {
      document.getElementById('result').innerHTML = `
        <h2>${row.Sözcük}</h2>
        <p><strong>Eş Anlamlılar:</strong> ${row['Eş Anlamlılar'] || '-'}</p>
        <p><strong>Açıklama:</strong> ${row.Açıklama || '-'}</p>
        <p><strong>Öz:</strong> ${row.Öz || '-'}</p>
      `;
    }

    document.getElementById('searchInput').addEventListener('input', (e) => {
      const val = e.target.value.trim();
      if (val === '') {
        document.getElementById('suggestions').innerHTML = '';
        return;
      }
      displaySuggestions(val);
    });

    fetchWords();
  </script>
</body>
</html>
