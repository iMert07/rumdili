<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yapay Dil Sözlüğü</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Yapay Dil Sözlüğü</h1>
        <div id="searchWrapper">
            <input type="text" id="searchInput" placeholder="Kelime ara...">
            <div id="suggestions"></div> <!-- Öneri Listesi -->
        </div>
        <div id="result"></div> <!-- Sonuç Ekranı -->
    </div>

    <script>
      async function fetchWords() {
        const sheetId = '1R01aIajx6dzHlO-KBiUXUmld2AEvxjCQkUTFGYB3EDM';
        const sheetName = 'Sayfa1';
        const url = `https://opensheet.elk.sh/${sheetId}/${sheetName}`;

        try {
          const response = await fetch(url);
          const data = await response.json();

          const searchInput = document.getElementById('searchInput');
          const resultDiv = document.getElementById('result');
          const suggestionsDiv = document.getElementById('suggestions');

          let selectedWord = null; // Şu an gösterilen kelime

          // Başlangıçta ekran boş
          showResult(null);
          suggestionsDiv.innerHTML = '';

          // Öneri listesini güncelleyen fonksiyon
          function updateSuggestions(query) {
            suggestionsDiv.innerHTML = '';
            if (query === '') return;

            // Kısmi eşleşme yapan kelimeleri bul
            const matches = data.filter(row => {
              const wordMatch = row.Sözcük?.toLowerCase().includes(query);
              const synonymsMatch = row['Eş Anlamlılar']?.toLowerCase()
                .split(',')
                .map(x => x.trim())
                .some(syn => syn.includes(query));
              return wordMatch || synonymsMatch;
            });

            // Önerileri sırala (kısa kelimeler önce)
            const sortedMatches = matches.sort((a, b) => {
              const lengthDifference = a.Sözcük.length - b.Sözcük.length;
              if (lengthDifference !== 0) return lengthDifference;
              return a.Sözcük.localeCompare(b.Sözcük);
            });

            // İlk 6 öneriyi göster
            const topMatches = sortedMatches.slice(0, 6);
            topMatches.forEach(match => {
              const suggestion = document.createElement('div');
              suggestion.textContent = match.Sözcük;
              suggestion.classList.add('suggestion');
              suggestion.addEventListener('click', () => {
                selectedWord = match; // Yeni kelime seçildi
                showResult(match); // Sonucu güncelle
                suggestionsDiv.innerHTML = ''; // Önerileri temizle
                searchInput.value = match.Sözcük; // Arama çubuğunu güncelle
              });
              suggestionsDiv.appendChild(suggestion);
            });
          }

          // Sonuç ekranını güncelleyen fonksiyon
          function showResult(word) {
            if (word) {
              resultDiv.innerHTML = `
                <div>
                  <strong>${word.Sözcük}</strong><br>
                  <span style="color: gray;">(${word['Eş Anlamlılar'] || ''})</span><br>
                  <p>${word.Açıklama || ''}</p>
                </div>
              `;
            } else {
              resultDiv.innerHTML = ''; // Boş ekran
            }
          }

          // Arama çubuğuna her yazıldığında öneriler güncellenir
          searchInput.addEventListener('input', () => {
            const query = searchInput.value.trim().toLowerCase();
            updateSuggestions(query);
          });

          // Enter tuşuyla arama
          searchInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
              const query = searchInput.value.trim().toLowerCase();
              suggestionsDiv.innerHTML = ''; // Önerileri temizle

              if (query === '') {
                selectedWord = null;
                showResult(null);
                return;
              }

              // En iyi eşleşmeyi bul
              const bestMatch = data.find(row => row.Sözcük?.toLowerCase() === query) ||
                              data.find(row => row.Sözcük?.toLowerCase().includes(query)) ||
                              data.find(row => row['Eş Anlamlılar']?.toLowerCase()
                                .split(',')
                                .map(x => x.trim())
                                .includes(query));

              if (bestMatch) {
                selectedWord = bestMatch; // Yeni kelime seçildi
                showResult(bestMatch);
              } else {
                resultDiv.innerHTML = '<p>Aradığınız kelime bulunamadı.</p>';
              }
            }
          });

        } catch (error) {
          console.error('Veri çekme hatası:', error);
          document.getElementById('result').innerHTML = '<p>Veriler yüklenemedi. Lütfen daha sonra tekrar deneyin.</p>';
        }
      }

      window.onload = fetchWords;
    </script>

    <style>
      .suggestion {
        padding: 8px;
        background-color: #f0f0f0;
        margin: 4px 0;
        cursor: pointer;
      }
      .suggestion:hover {
        background-color: #e0e0e0;
      }

      #searchWrapper {
        margin-bottom: 120px; /* Öneriler için boşluk */
      }

      #suggestions {
        max-height: 160px;
        overflow-y: auto;
        margin-top: 10px;
      }

      #result {
        margin-top: 20px;
      }
    </style>
</body>
</html>
